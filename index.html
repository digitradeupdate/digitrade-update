<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Digitrade Update</title>
<style>
  body { font-family: Arial, sans-serif; background:#f5f5f5; margin:0; padding:0; }
  #topMenuBox { background:#007bff; color:white; padding:15px 20px; display:flex; justify-content:space-between; align-items:center; box-shadow:0 2px 5px rgba(0,0,0,0.2);}
  #topMenuBox select, #topMenuBox button { padding:5px 10px; border-radius:5px; border:none; cursor:pointer; }
  #topMenuBox select { margin-right:10px; }
  .main-container { padding:20px; text-align:center; }
  #adminControls { margin:10px 0; display:none; }
  #adminControls button { margin:5px; padding:10px 15px; border:none; border-radius:5px; background:#28a745; color:white; cursor:pointer; }
  #adminControls button:hover { background:#1e7e34; }
  input[type="text"], select, textarea { width:60%; padding:6px; margin:5px 0; border-radius:5px; border:1px solid #ccc; }
  #filterButtons button { margin:5px; padding:8px 12px; background:#17a2b8; color:white; border:none; border-radius:5px; cursor:pointer; }
  #filterButtons button:hover { background:#117a8b; }
  #counter { font-weight:bold; margin-top:10px; color:green; }
  #container { margin-top:20px; display:flex; flex-wrap:wrap; justify-content:center; gap:15px; }
  .card { background:white; padding:15px; width:280px; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,0.1); text-align:left; position:relative; }
  .card img { width:100%; height:140px; object-fit:cover; border-radius:8px; margin-bottom:8px; }
  .card iframe { width:100%; height:160px; border-radius:8px; margin-top:8px; }
  .delete-btn, .edit-btn, .save-btn { position:absolute; top:10px; border:none; padding:5px 10px; border-radius:5px; cursor:pointer; color:white; }
  .delete-btn { background:red; right:10px; }
  .edit-btn { background:orange; right:60px; }
  .save-btn { background:green; margin-top:5px; position:static; display:inline-block; }
</style>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>
<body>

<div id="topMenuBox">
  <div>
    <select id="languageSelect" onchange="changeLanguage()">
      <option value="en">English</option>
      <option value="ha">Hausa</option>
    </select>
    <button onclick="loginAdmin()">Login Admin</button>
  </div>
  <div id="welcomeMsg"></div>
</div>

<div class="main-container">
  <div id="adminControls">
    <button onclick="addCard()">Æ˜ara Card</button>
    <input type="text" id="searchBox" placeholder="Search Card..." onkeyup="searchCards()">
    <div id="filterButtons">
      <button onclick="filterCategory('All')">All</button>
      <button onclick="filterCategory('Online Works')">Online Works</button>
      <button onclick="filterCategory('Mining')">Mining</button>
      <button onclick="filterCategory('Trading')">Trading</button>
    </div>
  </div>
  <p id="counter">Total Cards: 0</p>
  <div id="container"></div>
</div>

<script>
let isAdmin=false;
const adminPassword="Sawuta24@ADO";

// TODO: Replace with your Firebase config
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_PROJECT_ID.appspot.com",
  messagingSenderId: "YOUR_SENDER_ID",
  appId: "YOUR_APP_ID"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const cardsCollection = db.collection("cards");

function renderCard(docData,id){
  const newDiv=document.createElement("div");
  newDiv.classList.add("card");
  newDiv.dataset.category=docData.category;
  newDiv.dataset.id=id;
  newDiv.innerHTML=`
    <img src="${docData.img}" alt="banner">
    <h3>${docData.title}</h3>
    <p>${docData.desc}</p>
    <iframe src="${docData.video}" frameborder="0" allowfullscreen></iframe>
    <p><strong>Category:</strong> ${docData.category}</p>
    ${isAdmin?'<button class="edit-btn" onclick="editCard(this)">Edit</button><button class="delete-btn" onclick="deleteCard(this)">X</button>':''}
  `;
  document.getElementById("container").appendChild(newDiv);
}

function updateCounter(){
  let lang=document.getElementById("languageSelect").value;
  document.getElementById("counter").innerText=(lang==="ha"?"Jimlar Cards: ":"Total Cards: ")+document.querySelectorAll(".card").length;
}

// Load cards from Firestore
function loadCards(){
  document.getElementById("container").innerHTML="";
  cardsCollection.get().then(snapshot=>{
    snapshot.forEach(doc=>{
      renderCard(doc.data(),doc.id);
    });
    updateCounter();
  });
}

// Admin login
function loginAdmin(){
  let pwd=prompt("Enter Admin Password:");
  if(pwd===adminPassword){
    isAdmin=true;
    document.getElementById("adminControls").style.display="block";
    document.getElementById("welcomeMsg").innerText="Admin Logged In";
    alert("Welcome Admin!");
    loadCards(); // reload to show edit/delete buttons
  }else{alert("Wrong Password!");}
}

// Language switch
function changeLanguage(){
  let lang=document.getElementById("languageSelect").value;
  if(lang==="ha"){
    document.getElementById("searchBox").placeholder="Nema Card...";
    document.getElementById("counter").innerText="Jimlar Cards: "+document.querySelectorAll(".card").length;
    document.querySelectorAll("#filterButtons button")[0].innerText="Duka";
    document.querySelectorAll("#filterButtons button")[1].innerText="Ayyuka na Intanet";
    document.querySelectorAll("#filterButtons button")[2].innerText="Hako";
    document.querySelectorAll("#filterButtons button")[3].innerText="Kasuwanci";
  }else{
    document.getElementById("searchBox").placeholder="Search Card...";
    document.getElementById("counter").innerText="Total Cards: "+document.querySelectorAll(".card").length;
    document.querySelectorAll("#filterButtons button")[0].innerText="All";
    document.querySelectorAll("#filterButtons button")[1].innerText="Online Works";
    document.querySelectorAll("#filterButtons button")[2].innerText="Mining";
    document.querySelectorAll("#filterButtons button")[3].innerText="Trading";
  }
}

// Add card
function addCard(){
  if(!isAdmin){alert("Login Admin first!"); return;}
  let category=prompt("Enter category: Online Works, Mining, Trading","Online Works") || "Online Works";
  let newCard={title:"Card Title",desc:"Description here.",img:"https://via.placeholder.com/280x140",video:"https://www.youtube.com/embed/",category};
  cardsCollection.add(newCard).then(docRef=>{
    renderCard(newCard,docRef.id);
    updateCounter();
  });
}

// Delete card
function deleteCard(button){
  let cardDiv=button.parentElement;
  let docId=cardDiv.dataset.id;
  cardsCollection.doc(docId).delete().then(()=>{
    cardDiv.remove();
    updateCounter();
  });
}

// Search cards
function searchCards(){
  let input=document.getElementById("searchBox").value.toLowerCase();
  document.querySelectorAll(".card").forEach(card=>{
    let title=card.querySelector("h3").innerText.toLowerCase();
    card.style.display=title.includes(input)?"block":"none";
  });
}

// Filter
function filterCategory(category){
  document.querySelectorAll(".card").forEach(card=>{
    card.style.display=(category==="All" || card.dataset.category===category)?"block":"none";
  });
}

// Edit card (simplified)
function editCard(button){
  if(!isAdmin){alert("Login Admin first!"); return;}
  let card=button.parentElement;
  let docId=card.dataset.id;
  let title=prompt("Edit Title:",card.querySelector("h3").innerText);
  if(title===null)